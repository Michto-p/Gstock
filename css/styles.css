:root{
  --bg:#ffffff; --fg:#111827; --muted:#6b7280; --card:#f3f4f6; --primary:#2563eb;
  --ok:#10b981; --low:#f59e0b; --under:#ef4444; --danger:#dc2626; --border:#e5e7eb;
}
html[data-theme="dark"]{
  --bg:#0b1020; --fg:#e5e7eb; --muted:#9ca3af; --card:#121a2e; --primary:#3b82f6;
  --ok:#34d399; --low:#fbbf24; --under:#f87171; --danger:#ef4444; --border:#1f2937;
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;background:var(--bg);color:var(--fg);font:14px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,"Noto Sans",sans-serif}

.topbar{position:sticky;top:0;z-index:50;display:flex;align-items:center;gap:1rem;padding:.6rem .8rem;background:var(--card);border-bottom:1px solid var(--border)}
.brand{display:flex;align-items:center;gap:.5rem}
.brand .logo{font-size:1.3rem}
.muted{color:var(--muted)}
.grow{flex:1}
.theme select{padding:.3rem .5rem}

.tabs{position:sticky;top:48px;z-index:40;display:flex;gap:.4rem;padding:.4rem .6rem;background:var(--bg);border-bottom:1px solid var(--border);flex-wrap:wrap}
.tabs button{padding:.4rem .6rem;border:1px solid var(--border);background:var(--card);color:var(--fg);border-radius:.5rem}
.tabs button.active{background:var(--primary);color:#fff;border-color:var(--primary)}

main{padding:1rem;max-width:1100px;margin:0 auto}
.panel-head{display:flex;align-items:center;gap:.6rem;flex-wrap:wrap}
.panel-head .panel-actions{display:flex;gap:.4rem;flex-wrap:wrap;margin-left:auto}
.table-wrap{overflow:auto;border:1px solid var(--border);border-radius:.6rem;background:var(--bg);margin-top:.6rem}
.table{width:100%;border-collapse:collapse}
.table th,.table td{padding:.45rem .6rem;border-bottom:1px solid var(--border);vertical-align:middle}
.table thead th{position:sticky;top:0;background:var(--card);z-index:1}

.badge{padding:.1rem .4rem;border-radius:.4rem;border:1px solid transparent;font-size:.75rem}
.badge.ok{background:color-mix(in srgb,var(--ok) 15%, transparent);border-color:var(--ok)}
.badge.low{background:color-mix(in srgb,var(--low) 15%, transparent);border-color:var(--low)}
.badge.under{background:color-mix(in srgb,var(--under) 15%, transparent);border-color:var(--under)}

.btn{padding:.35rem .6rem;border:1px solid var(--border);background:var(--card);border-radius:.5rem;cursor:pointer}
.btn.primary{background:var(--primary);border-color:var(--primary);color:#fff}
.btn.danger{background:var(--danger);border-color:var(--danger);color:#fff}
.btn:disabled{opacity:.6;cursor:not-allowed}
.inline{display:flex;gap:.4rem;align-items:center}
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:.6rem}
@media (max-width:700px){ .grid-2{grid-template-columns:1fr} }

.kpis{display:grid;grid-template-columns:repeat(3,1fr);gap:.6rem;margin:.8rem 0}
@media (min-width:860px){ .kpis{grid-template-columns:repeat(6,1fr)} }
.kpi{background:var(--card);border:1px solid var(--border);padding:.6rem;border-radius:.6rem;text-align:center}
.kpi-num{font-size:1.4rem;font-weight:700}
.kpi .warn{color:var(--low)} .kpi .danger{color:var(--under)}

.list{padding:0;margin:.5rem 0;list-style:none}
.list.scroll{max-height:360px;overflow:auto;border:1px solid var(--border);border-radius:.5rem;padding:.4rem}
.row{display:flex;align-items:center;justify-content:space-between;padding:.3rem .4rem;border-bottom:1px dashed var(--border)}
.row:last-child{border-bottom:0}

.chips{display:flex;gap:.4rem;flex-wrap:wrap}
.chip,.pill{display:inline-flex;align-items:center;gap:.3rem;padding:.2rem .5rem;border-radius:999px;background:var(--card);border:1px solid var(--border)}
.pill{font-size:.8rem}

.dialog{border:none;border-radius:.8rem;padding:1rem;max-width:640px;width:100%}
.dialog::backdrop{background:rgba(0,0,0,.45)}
.dialog .dialog-actions{display:flex;gap:.4rem;justify-content:flex-end;margin-top:.6rem}

.scanner{display:grid;gap:.5rem}
#scanVideo,#loanVideo{width:100%;max-height:50vh;background:#000;border-radius:.6rem}
.scan-actions{display:flex;gap:.4rem;flex-wrap:wrap}

.labels-grid{display:grid;gap:1rem;grid-template-columns:320px 1fr}
@media (max-width:960px){ .labels-grid{grid-template-columns:1fr} }
.labels-left{display:grid;gap:.6rem}
.form-row{display:flex;gap:.4rem;align-items:center}
.form-grid-2{display:grid;grid-template-columns:1fr 1fr;gap:.4rem}
.labels-preview{border:1px solid var(--border);background:#fff;border-radius:.6rem;padding:.6rem;overflow:auto;min-height:420px}
.labels-pages{position:relative}
.labels-page{display:none}
.labels-page.active{display:block}
.labels-sheet{display:grid;background:#fff}
.label-card{display:flex;flex-direction:column;justify-content:center;align-items:center;border:1px solid transparent;padding:2mm}
.label-card .name{font-weight:600;margin-bottom:2mm}
.label-card .hr{font-size:8pt;color:#666;margin-bottom:1mm}

.help{background:var(--card);border:1px solid var(--border);padding:.6rem;border-radius:.6rem}
.list-editor{display:grid;gap:.4rem}
.sortable{list-style:none;margin:0;padding:0;border:1px solid var(--border);border-radius:.5rem;overflow:hidden}
.sortable li{display:flex;align-items:center;gap:.5rem;padding:.35rem .5rem;border-bottom:1px dashed var(--border)}
.sortable li:last-child{border-bottom:0}
.sortable .drag{cursor:grab;color:var(--muted)}

.sr-only{position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden}

/* Print : cache l’UI, n’imprime que les pages d’étiquettes */
@media print{
  body{background:#fff;color:#000}
  .topbar,.tabs,main > section:not(#tab-labels),.panel-head,.labels-left,.pager,.print-actions{display:none !important}
  #tab-labels{display:block !important}
  .labels-preview{border:none;padding:0}
  .labels-page{display:block !important;break-after:page}
  .labels-sheet{margin:0}
}
/* --- Cartes étiquette : contrainte visuelle côté écran & impression --- */
.labels-page { display: none; }              /* une page visible à la fois à l'écran */
.labels-page.active { display: block; }
.labels-sheet { display: grid; }

/* Empêcher tout débordement interne */
.label-card {
  box-sizing: border-box;
  padding: 2mm 2mm 1mm 2mm;   /* marges internes douces */
  overflow: hidden;
}
.label-card .name {
  font-weight: 600;
  line-height: 1.1;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.label-card .hr {
  font-size: 9pt;
  line-height: 1.1;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
/* Le SVG est ajusté côté JS (width:100% + max-height en mm) */

/* --- Impression A4 optimisée : on imprime uniquement l'onglet Étiquettes --- */
@page {
  size: A4;
  margin: 0;                 /* on s'appuie sur margins du template */
}
@media print {
  /* On n’imprime que la zone des étiquettes */
  body * { visibility: hidden !important; }
  #tab-labels, #tab-labels * { visibility: visible !important; }
  #tab-labels { position: absolute; inset: 0; }

  /* Toutes les pages d'étiquettes s'enchaînent sur plusieurs feuilles */
  .labels-page { display: block !important; break-after: page; }

  /* Cache la navigation/headers/footers si existants */
  nav, header, footer, .toolbar, .filters { display: none !important; }

  /* Pas d'ombres/couleurs parasites à l'impression */
  .label-card { box-shadow: none !important; border: none !important; }
}
